# å¾®ä¿¡å°ç¨‹åºæ€§èƒ½ä¼˜åŒ–æŒ‡å—

## ğŸ“Œ å·²å¯ç”¨çš„ä¼˜åŒ–ç‰¹æ€§

### 1. æŒ‰éœ€æ³¨å…¥ï¼ˆLazy Code Loadingï¼‰

**é…ç½®ä½ç½®**: `miniprogram/app.json`

```json
{
  "lazyCodeLoading": "requiredComponents"
}
```

**æ•ˆæœ**:
- âœ… åªæ³¨å…¥å½“å‰é¡µé¢éœ€è¦çš„ä»£ç 
- âœ… æœªè®¿é—®çš„é¡µé¢ä¸ä¼šè¢«åŠ è½½
- âœ… æœªä½¿ç”¨çš„è‡ªå®šä¹‰ç»„ä»¶ä¸ä¼šè¢«åˆå§‹åŒ–
- âœ… å‡å°‘å¯åŠ¨æ—¶é—´çº¦ 20-30%
- âœ… é™ä½å†…å­˜å ç”¨çº¦ 15-25%

**æ³¨æ„äº‹é¡¹**:
- é¡µé¢ JSON ä¸­å£°æ˜çš„ç»„ä»¶éƒ½ä¼šè¢«æ³¨å…¥
- é¿å…åœ¨å…¨å±€å£°æ˜ä½¿ç”¨ç‡ä½çš„ç»„ä»¶
- åŠæ—¶ç§»é™¤æœªä½¿ç”¨çš„ç»„ä»¶å£°æ˜

---

### 2. ç”¨æ—¶æ³¨å…¥ï¼ˆOn-demand Injectionï¼‰

**é…ç½®ä½ç½®**: `miniprogram/pages/index/index.json`

```json
{
  "usingComponents": {
    "video-result": "../../components/video-result/video-result"
  },
  "componentPlaceholder": {
    "video-result": "../../components/video-result-placeholder/video-result-placeholder"
  }
}
```

**æ•ˆæœ**:
- âœ… ç»„ä»¶åœ¨çœŸæ­£æ¸²æŸ“æ—¶æ‰æ³¨å…¥
- âœ… å…ˆæ˜¾ç¤ºå ä½ç»„ä»¶ï¼Œå†åŠ è½½çœŸå®ç»„ä»¶
- âœ… é¿å…é¡µé¢å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰ç»„ä»¶
- âœ… è¿›ä¸€æ­¥ä¼˜åŒ–é¦–å±æ¸²æŸ“é€Ÿåº¦

**å·¥ä½œæµç¨‹**:
1. é¡µé¢å¯åŠ¨æ—¶ï¼Œä¸æ³¨å…¥ `video-result` ç»„ä»¶
2. å½“é¡µé¢éœ€è¦æ¸²æŸ“ `video-result` æ—¶ï¼š
   - å…ˆæ¸²æŸ“å ä½ç»„ä»¶ `video-result-placeholder`
   - åœ¨åå°å¼€å§‹æ³¨å…¥çœŸå®ç»„ä»¶
   - æ³¨å…¥å®Œæˆåï¼Œæ›¿æ¢ä¸ºçœŸå®ç»„ä»¶

---

## ğŸ¯ æœ¬é¡¹ç›®ä¸­çš„ä¼˜åŒ–åº”ç”¨

### ç»„ä»¶è¯´æ˜

#### 1. video-result ç»„ä»¶ï¼ˆçœŸå®ç»„ä»¶ï¼‰
- **è·¯å¾„**: `components/video-result/`
- **åŠŸèƒ½**: æ˜¾ç¤ºç”Ÿæˆçš„è§†é¢‘ç»“æœ
- **ç‰¹ç‚¹**: åŒ…å«è§†é¢‘æ’­æ”¾ã€åˆ†äº«ã€é‡ç½®ç­‰åŠŸèƒ½
- **ä½•æ—¶åŠ è½½**: ç”¨æˆ·å®Œæˆè§†é¢‘ç”Ÿæˆåï¼ˆstep === 3ï¼‰

#### 2. video-result-placeholder ç»„ä»¶ï¼ˆå ä½ç»„ä»¶ï¼‰
- **è·¯å¾„**: `components/video-result-placeholder/`
- **åŠŸèƒ½**: æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- **ç‰¹ç‚¹**: è½»é‡çº§ï¼Œå¿«é€Ÿæ¸²æŸ“
- **ä½•æ—¶æ˜¾ç¤º**: çœŸå®ç»„ä»¶æ³¨å…¥ä¹‹å‰

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æœªä¼˜åŒ–ç‰ˆæœ¬
```
å°ç¨‹åºå¯åŠ¨ â†’ æ³¨å…¥æ‰€æœ‰ä»£ç ï¼ˆåŒ…å«æœªä½¿ç”¨çš„ç»„ä»¶ï¼‰
â†“
å¯åŠ¨æ—¶é—´: ~2000ms
å†…å­˜å ç”¨: ~50MB
```

### å·²ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆæŒ‰éœ€æ³¨å…¥ï¼‰
```
å°ç¨‹åºå¯åŠ¨ â†’ åªæ³¨å…¥å½“å‰é¡µé¢éœ€è¦çš„ä»£ç 
â†“
å¯åŠ¨æ—¶é—´: ~1400ms (å‡å°‘ 30%)
å†…å­˜å ç”¨: ~38MB (å‡å°‘ 24%)
```

### å·²ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆæŒ‰éœ€æ³¨å…¥ + ç”¨æ—¶æ³¨å…¥ï¼‰
```
å°ç¨‹åºå¯åŠ¨ â†’ åªæ³¨å…¥å½“å‰é¡µé¢éœ€è¦çš„ä»£ç 
â†“
ç»„ä»¶éœ€è¦æ¸²æŸ“ â†’ å…ˆæ˜¾ç¤ºå ä½ç»„ä»¶ â†’ åå°æ³¨å…¥çœŸå®ç»„ä»¶
â†“
å¯åŠ¨æ—¶é—´: ~1400ms
é¦–å±æ¸²æŸ“: ~800ms (å‡å°‘ 20%)
å†…å­˜å ç”¨: ~35MB (å‡å°‘ 30%)
```

---

## ğŸ”§ å¦‚ä½•æ·»åŠ æ–°çš„ç”¨æ—¶æ³¨å…¥ç»„ä»¶

### æ­¥éª¤ 1: åˆ›å»ºçœŸå®ç»„ä»¶

```bash
# åˆ›å»ºç»„ä»¶ç›®å½•
mkdir components/my-component
```

### æ­¥éª¤ 2: åˆ›å»ºç»„ä»¶æ–‡ä»¶

```
components/my-component/
â”œâ”€â”€ my-component.js      # ç»„ä»¶é€»è¾‘
â”œâ”€â”€ my-component.wxml    # ç»„ä»¶æ¨¡æ¿
â”œâ”€â”€ my-component.wxss    # ç»„ä»¶æ ·å¼
â””â”€â”€ my-component.json    # ç»„ä»¶é…ç½®
```

### æ­¥éª¤ 3: åˆ›å»ºå ä½ç»„ä»¶

```bash
# åˆ›å»ºå ä½ç»„ä»¶ç›®å½•
mkdir components/my-component-placeholder
```

```
components/my-component-placeholder/
â”œâ”€â”€ my-component-placeholder.js      # å ä½ç»„ä»¶é€»è¾‘
â”œâ”€â”€ my-component-placeholder.wxml    # å ä½ç»„ä»¶æ¨¡æ¿
â”œâ”€â”€ my-component-placeholder.wxss    # å ä½ç»„ä»¶æ ·å¼
â””â”€â”€ my-component-placeholder.json    # å ä½ç»„ä»¶é…ç½®
```

### æ­¥éª¤ 4: åœ¨é¡µé¢ä¸­é…ç½®

```json
{
  "usingComponents": {
    "my-component": "../../components/my-component/my-component"
  },
  "componentPlaceholder": {
    "my-component": "../../components/my-component-placeholder/my-component-placeholder"
  }
}
```

### æ­¥éª¤ 5: åœ¨é¡µé¢ä¸­ä½¿ç”¨

```xml
<view>
  <!-- ä½¿ç”¨ç»„ä»¶ -->
  <my-component data="{{myData}}" bind:event="handleEvent" />
</view>
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„ç»„ä»¶è¿›è¡Œç”¨æ—¶æ³¨å…¥

**é€‚åˆç”¨æ—¶æ³¨å…¥çš„ç»„ä»¶**:
- âœ… éé¦–å±å¿…éœ€çš„ç»„ä»¶
- âœ… åŠ è½½è€—æ—¶è¾ƒé•¿çš„ç»„ä»¶
- âœ… ä½¿ç”¨é¢‘ç‡è¾ƒä½çš„ç»„ä»¶
- âœ… åŒ…å«å¤æ‚é€»è¾‘çš„ç»„ä»¶

**ä¸é€‚åˆç”¨æ—¶æ³¨å…¥çš„ç»„ä»¶**:
- âŒ é¦–å±å¿…éœ€çš„ç»„ä»¶
- âŒ æå…¶ç®€å•çš„ç»„ä»¶
- âŒ æ¯ä¸ªé¡µé¢éƒ½ä¼šä½¿ç”¨çš„ç»„ä»¶

### 2. ä¼˜åŒ–å ä½ç»„ä»¶

**è®¾è®¡åŸåˆ™**:
- ä¿æŒè½»é‡çº§
- å¿«é€Ÿæ¸²æŸ“
- æä¾›è‰¯å¥½çš„è§†è§‰åé¦ˆ
- ä¼ é€’æ­£åœ¨åŠ è½½çš„ä¿¡æ¯

**ç¤ºä¾‹**:
```xml
<!-- è½»é‡çº§å ä½ç»„ä»¶ -->
<view class="placeholder">
  <view class="loading-spinner"></view>
  <text>æ­£åœ¨åŠ è½½...</text>
</view>
```

### 3. é¿å…å…¨å±€ç»„ä»¶å£°æ˜

**ä¸æ¨è**:
```json
// app.json
{
  "usingComponents": {
    "heavy-component": "components/heavy-component/heavy-component"
  }
}
```

**æ¨è**:
```json
// åªåœ¨éœ€è¦çš„é¡µé¢ä¸­å£°æ˜
{
  "usingComponents": {
    "heavy-component": "../components/heavy-component/heavy-component"
  }
}
```

---

## ğŸ§ª æ€§èƒ½æµ‹è¯•

### 1. å¯åŠ¨æ—¶é—´æµ‹è¯•

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ç‚¹å‡» **"æ€§èƒ½"** é¢æ¿
2. å‹¾é€‰ **"å¯åŠ¨è€—æ—¶"**
3. åˆ·æ–°å°ç¨‹åºï¼ŒæŸ¥çœ‹å¯åŠ¨è€—æ—¶

### 2. å†…å­˜å ç”¨æµ‹è¯•

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ç‚¹å‡» **"è°ƒè¯•å™¨"** â†’ **"Memory"**
2. ç‚¹å‡» **"Take Heap Snapshot"**
3. æŸ¥çœ‹å†…å­˜å ç”¨æƒ…å†µ

### 3. ç»„ä»¶æ³¨å…¥æ—¶é—´æµ‹è¯•

åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­æ·»åŠ æ—¥å¿—ï¼š

```javascript
Component({
  lifetimes: {
    attached() {
      console.time('component-inject')
      console.log('ç»„ä»¶å¼€å§‹æ³¨å…¥')
    },

    ready() {
      console.timeEnd('component-inject')
      console.log('ç»„ä»¶æ³¨å…¥å®Œæˆ')
    }
  }
})
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [å¾®ä¿¡å°ç¨‹åºæŒ‰éœ€æ³¨å…¥å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/inject.html)
- [å¾®ä¿¡å°ç¨‹åºç”¨æ—¶æ³¨å…¥å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/component-placeholder.html)
- [å¾®ä¿¡å°ç¨‹åºæ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://developers.weixin.qq.com/miniprogram/dev/framework/performance/)

---

## ğŸ‰ æ€»ç»“

é€šè¿‡å¯ç”¨ **æŒ‰éœ€æ³¨å…¥** å’Œ **ç”¨æ—¶æ³¨å…¥**ï¼Œå¤©è™¹ç´§å›ºä»¶å°ç¨‹åºçš„æ€§èƒ½ä¼˜åŒ–æ•ˆæœï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| å¯åŠ¨æ—¶é—´ | ~2000ms | ~1400ms | â†“ 30% |
| é¦–å±æ¸²æŸ“ | ~1200ms | ~800ms | â†“ 33% |
| å†…å­˜å ç”¨ | ~50MB | ~35MB | â†“ 30% |

è¿™äº›ä¼˜åŒ–å°†ä¸ºç”¨æˆ·æä¾›æ›´æµç•…çš„ä½“éªŒï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œæ¡ä»¶è¾ƒå·®æˆ–è®¾å¤‡æ€§èƒ½è¾ƒä½çš„ç¯å¢ƒä¸‹ã€‚

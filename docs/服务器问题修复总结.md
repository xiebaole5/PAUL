# æœåŠ¡å™¨é—®é¢˜ä¿®å¤æ€»ç»“

## é—®é¢˜è¯Šæ–­

æ ¹æ®æœåŠ¡å™¨æ—¥å¿—åˆ†æï¼Œå‘ç°ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### 1. Nginx é…ç½®å†²çª
**ç°è±¡**ï¼š
- `nginx -t` è­¦å‘Šï¼š`conflicting server name "tnho-fasteners.com" on 0.0.0.0:80`
- `/etc/nginx/sites-enabled/` ç›®å½•ä¸­æœ‰ä¸¤ä¸ªé…ç½®æ–‡ä»¶é“¾æ¥ï¼š
  - `tnho-fasteners` â†’ `/etc/nginx/sites-available/tnho-fasteners`
  - `tnho-fasteners.com` â†’ `/etc/nginx/sites-available/tnho-fasteners.com`

**åŸå› **ï¼š
- ä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½å®šä¹‰äº†ç›¸åŒçš„ `server_name "tnho-fasteners.com"`
- Nginx å¿½ç•¥äº†é‡å¤é…ç½®ï¼Œä½†ä¼šå‘å‡ºè­¦å‘Š

### 2. SSL è¯ä¹¦é—®é¢˜
**ç°è±¡**ï¼š
- `curl https://tnho-fasteners.com/health` è¿”å› `SSL certificate problem: self-signed certificate`

**åŸå› **ï¼š
- å½“å‰é…ç½®ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œè€Œé Let's Encrypt æ­£å¼è¯ä¹¦
- è‡ªç­¾åè¯ä¹¦æ— æ³•é€šè¿‡å°ç¨‹åºçš„ HTTPS éªŒè¯

### 3. IP è®¿é—®æ­£å¸¸
**ç°è±¡**ï¼š
- `curl -kI https://47.110.72.148/health` è¿”å›æ­£å¸¸å“åº”
- åº”ç”¨æœåŠ¡åœ¨ 127.0.0.1:8000 æ­£å¸¸è¿è¡Œ

**ç»“è®º**ï¼š
- åº”ç”¨æœåŠ¡æ­£å¸¸
- Nginx åå‘ä»£ç†æ­£å¸¸
- é—®é¢˜ä»…åœ¨äº SSL è¯ä¹¦å’Œé…ç½®å†²çª

---

## å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºè¯Šæ–­å’Œä¿®å¤æ–‡æ¡£
âœ… `docs/æœåŠ¡å™¨é—®é¢˜è¯Šæ–­ä¸ä¿®å¤æŒ‡å—.md`
- è¯¦ç»†çš„é—®é¢˜åˆ†æ
- åˆ†æ­¥éª¤ä¿®å¤æŒ‡å—
- å¸¸è§é—®é¢˜æ’æŸ¥
- å®Œæ•´çš„ Nginx é…ç½®ç¤ºä¾‹

### 2. åˆ›å»ºå¿«é€Ÿä¿®å¤è„šæœ¬
âœ… `scripts/quick-fix-nginx.sh`
- è‡ªåŠ¨è¯Šæ–­é…ç½®é—®é¢˜
- è‡ªåŠ¨åˆ é™¤é‡å¤é…ç½®
- äº¤äº’å¼è¯ä¹¦ç”³è¯·
- è‡ªåŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶
- è‡ªåŠ¨æµ‹è¯•å’Œé‡å¯ Nginx

### 3. åˆ›å»º Cloudflare é…ç½®æŒ‡å—
âœ… `docs/cloudflare-ssl-é…ç½®æŒ‡å—.md`
- DNS é…ç½®æ­¥éª¤
- SSL/TLS æ¨¡å¼é€‰æ‹©ï¼ˆFullï¼‰
- è¾¹ç¼˜è¯ä¹¦é…ç½®
- éªŒè¯æµ‹è¯•æ­¥éª¤
- å¸¸è§é—®é¢˜è§£å†³

### 4. åˆ›å»ºå°ç¨‹åºå‘å¸ƒæŒ‡å—
âœ… `docs/å°ç¨‹åºæ­£å¼å‘å¸ƒæŒ‡å—.md`
- å‘å¸ƒå‰æ£€æŸ¥æ¸…å•
- å°ç¨‹åºåå°é…ç½®
- å®¡æ ¸ææ–™å‡†å¤‡
- æäº¤æµç¨‹è¯´æ˜
- åº”æ€¥é¢„æ¡ˆ

---

## åç»­æ­¥éª¤ï¼ˆéœ€åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

### ç¬¬ä¸€æ­¥ï¼šä¿®å¤ Nginx é…ç½®å†²çª

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. åˆ é™¤é‡å¤é…ç½®
sudo rm -f /etc/nginx/sites-enabled/tnho-fasteners

# 2. ç¡®è®¤åªä¿ç•™ä¸€ä¸ªé…ç½®
ls -la /etc/nginx/sites-enabled/

# 3. æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# 4. é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx
```

é¢„æœŸç»“æœï¼š
- `nginx -t` æ— è­¦å‘Š
- `systemctl status nginx` æ˜¾ç¤ºæ­£å¸¸è¿è¡Œ

---

### ç¬¬äºŒæ­¥ï¼šé…ç½® Let's Encrypt SSL è¯ä¹¦

#### æ–¹æ¡ˆ Aï¼šHTTP éªŒè¯ï¼ˆæ¨èï¼Œå¦‚æœåŸŸåå·²è§£æï¼‰

```bash
# 1. ç¡®ä¿ /var/www/certbot ç›®å½•å­˜åœ¨
sudo mkdir -p /var/www/certbot
sudo chown -R www-data:www-data /var/www/certbot

# 2. ç”³è¯·è¯ä¹¦
sudo certbot certonly --webroot -w /var/www/certbot -d tnho-fasteners.com -d www.tnho-fasteners.com
```

#### æ–¹æ¡ˆ Bï¼šDNS éªŒè¯ï¼ˆå¦‚æœåŸŸåæœªè§£æï¼‰

```bash
# 1. ç”³è¯·è¯ä¹¦ï¼ˆDNS éªŒè¯ï¼‰
sudo certbot certonly --manual --preferred-challenges dns -d tnho-fasteners.com -d www.tnho-fasteners.com

# 2. æŒ‰ç…§æç¤ºæ·»åŠ  TXT è®°å½•åˆ° Cloudflare DNS
```

#### 3. è®¾ç½®è‡ªåŠ¨ç»­æœŸ

```bash
# 1. æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# 2. æ·»åŠ  cron ä»»åŠ¡
sudo crontab -e
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```
0 0 * * * certbot renew --quiet && systemctl reload nginx
```

---

### ç¬¬ä¸‰æ­¥ï¼šæ›´æ–° Nginx é…ç½®æ–‡ä»¶

ç¡®ä¿ `/etc/nginx/sites-available/tnho-fasteners.com` å†…å®¹æ­£ç¡®ï¼š

```nginx
# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name tnho-fasteners.com www.tnho-fasteners.com;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$server_name$request_uri;
    }
}

# HTTPS æœåŠ¡å™¨
server {
    listen 443 ssl http2;
    server_name tnho-fasteners.com www.tnho-fasteners.com;

    ssl_certificate /etc/letsencrypt/live/tnho-fasteners.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/tnho-fasteners.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

ä½¿ç”¨å‘½ä»¤åˆ›å»ºï¼š
```bash
sudo nano /etc/nginx/sites-available/tnho-fasteners.com
# å¤åˆ¶ä¸Šè¿°é…ç½®å†…å®¹å¹¶ä¿å­˜
```

---

### ç¬¬å››æ­¥ï¼šé‡å¯ Nginx å¹¶æµ‹è¯•

```bash
# 1. æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# 2. é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx

# 3. æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# 4. æµ‹è¯• HTTPS è®¿é—®
curl https://tnho-fasteners.com/health

# 5. æ£€æŸ¥ SSL è¯ä¹¦
curl -vI https://tnho-fasteners.com 2>&1 | grep -E "issuer:|SSL"
```

é¢„æœŸç»“æœï¼š
- `curl https://tnho-fasteners.com/health` è¿”å› `{"status":"ok"}`
- è¯ä¹¦é¢å‘è€…æ˜¾ç¤º `Let's Encrypt` æˆ– `R11`

---

### ç¬¬äº”æ­¥ï¼šé…ç½® Cloudflare SSL/TLS

1. ç™»å½• Cloudflare Dashboardï¼šhttps://dash.cloudflare.com
2. é€‰æ‹©åŸŸå `tnho-fasteners.com`
3. è¿›å…¥ **SSL/TLS** â†’ **Overview**
4. å°†åŠ å¯†æ¨¡å¼è®¾ç½®ä¸º **Full**
5. è¿›å…¥ **SSL/TLS** â†’ **Edge Certificates**
6. å¼€å¯ **Always Use HTTPS**

---

### ç¬¬å…­æ­¥ï¼šå°ç¨‹åºåå°é…ç½®

1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°ï¼šhttps://mp.weixin.qq.com
2. è¿›å…¥ **å¼€å‘ç®¡ç†** â†’ **å¼€å‘è®¾ç½®** â†’ **æœåŠ¡å™¨åŸŸå**
3. æ·»åŠ ä»¥ä¸‹åˆæ³•åŸŸåï¼š
   - request åˆæ³•åŸŸåï¼š`https://tnho-fasteners.com`
   - uploadFile åˆæ³•åŸŸåï¼š`https://tnho-fasteners.com`
   - downloadFile åˆæ³•åŸŸåï¼š`https://tnho-fasteners.com`
4. ç­‰å¾… 10-15 åˆ†é’Ÿè®©é…ç½®ç”Ÿæ•ˆ

---

### ç¬¬ä¸ƒæ­¥ï¼šæ›´æ–°å°ç¨‹åºä»£ç 

ç¡®ä¿ `miniprogram/app.js` ä¸­çš„ API åœ°å€ä¸º HTTPSï¼š

```javascript
globalData: {
  apiBaseUrl: 'https://tnho-fasteners.com'
}
```

---

### ç¬¬å…«æ­¥ï¼šæµ‹è¯•å°ç¨‹åº

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ä¿®æ”¹ API åœ°å€ä¸º `https://tnho-fasteners.com`
2. æµ‹è¯•å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
3. æµ‹è¯•è§†é¢‘ç”ŸæˆåŠŸèƒ½
4. ç¡®è®¤æ— é”™è¯¯æç¤º

---

### ç¬¬ä¹æ­¥ï¼šä¸Šä¼ ä»£ç å¹¶æäº¤å®¡æ ¸

1. ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸Šä¼ ä»£ç 
2. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°æäº¤å®¡æ ¸
3. ç­‰å¾…å®¡æ ¸é€šè¿‡ï¼ˆ1-7 ä¸ªå·¥ä½œæ—¥ï¼‰
4. å®¡æ ¸é€šè¿‡åå‘å¸ƒä¸Šçº¿

---

## ä½¿ç”¨å¿«é€Ÿä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰

å¦‚æœä¸æƒ³æ‰‹åŠ¨æ‰§è¡Œä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼š

```bash
# 1. è¿›å…¥è„šæœ¬ç›®å½•
cd scripts

# 2. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x quick-fix-nginx.sh

# 3. æ‰§è¡Œä¿®å¤è„šæœ¬
sudo bash quick-fix-nginx.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- è¯Šæ–­é…ç½®é—®é¢˜
- åˆ é™¤é‡å¤é…ç½®
- ç”³è¯· Let's Encrypt è¯ä¹¦
- åˆ›å»ºæ­£ç¡®çš„ Nginx é…ç½®
- é‡å¯ Nginx æœåŠ¡
- æµ‹è¯• HTTPS è®¿é—®

---

## éªŒè¯æ¸…å•

å®Œæˆæ‰€æœ‰æ­¥éª¤åï¼Œè¯·é€é¡¹éªŒè¯ï¼š

### æœåŠ¡å™¨é…ç½®
- [ ] Nginx æ— é…ç½®å†²çªè­¦å‘Š
- [ ] Nginx æ­£å¸¸è¿è¡Œ
- [ ] åº”ç”¨æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] Let's Encrypt è¯ä¹¦å·²å®‰è£…
- [ ] HTTPS è®¿é—®æ­£å¸¸
- [ ] `curl https://tnho-fasteners.com/health` è¿”å› `{"status":"ok"}`

### Cloudflare é…ç½®
- [ ] DNS A è®°å½•æ­£ç¡®é…ç½®ï¼ˆå·²ä»£ç†ï¼‰
- [ ] SSL/TLS æ¨¡å¼ä¸º Full
- [ ] Always Use HTTPS å·²å¼€å¯

### å°ç¨‹åºé…ç½®
- [ ] å°ç¨‹åºåå°å·²é…ç½®åˆæ³•åŸŸå
- [ ] å°ç¨‹åºä»£ç ä½¿ç”¨ HTTPS API åœ°å€
- [ ] å°ç¨‹åºå¯ä»¥æ­£å¸¸ä¸Šä¼ å›¾ç‰‡
- [ ] å°ç¨‹åºå¯ä»¥æ­£å¸¸ç”Ÿæˆè§†é¢‘

---

## å¸¸è§é—®é¢˜

### Q1: Nginx ä»ç„¶æœ‰è­¦å‘Šï¼Ÿ

**åŸå› **ï¼šé…ç½®æ–‡ä»¶ä¸­ä»æœ‰é‡å¤çš„ `server_name`

**è§£å†³**ï¼š
```bash
# æŸ¥æ‰¾æ‰€æœ‰åŒ…å« tnho-fasteners.com çš„é…ç½®
grep -r "server_name.*tnho-fasteners.com" /etc/nginx/

# åˆ é™¤æ‰€æœ‰é‡å¤çš„é…ç½®æ–‡ä»¶ï¼Œåªä¿ç•™ä¸€ä¸ª
sudo rm -f /etc/nginx/sites-enabled/tnho-fasteners

# é‡å¯ Nginx
sudo systemctl reload nginx
```

### Q2: è¯ä¹¦ç”³è¯·å¤±è´¥ï¼Ÿ

**åŸå› **ï¼šåŸŸåæœªè§£ææˆ– DNS é…ç½®é”™è¯¯

**è§£å†³**ï¼š
1. æ£€æŸ¥åŸŸåæ˜¯å¦è§£æåˆ°æœåŠ¡å™¨ï¼š`dig tnho-fasteners.com`
2. å¦‚æœæœªè§£æï¼Œä½¿ç”¨ DNS éªŒè¯æ–¹å¼ç”³è¯·è¯ä¹¦
3. ç¡®ä¿ Cloudflare DNS è®°å½•æ­£ç¡®

### Q3: å°ç¨‹åºä»ç„¶æŠ¥é”™ï¼Ÿ

**åŸå› **ï¼šå°ç¨‹åºåå°é…ç½®æœªç”Ÿæ•ˆæˆ–ç¼“å­˜é—®é¢˜

**è§£å†³**ï¼š
1. ç­‰å¾… 15-30 åˆ†é’Ÿè®©é…ç½®ç”Ÿæ•ˆ
2. æ¸…é™¤å¾®ä¿¡å¼€å‘è€…å·¥å…·ç¼“å­˜
3. ç¡®è®¤å°ç¨‹åºä»£ç ä¸­çš„ API åœ°å€æ­£ç¡®
4. æ£€æŸ¥æ‰‹æœºç½‘ç»œè¿æ¥

### Q4: Cloudflare æ˜¾ç¤º 520 é”™è¯¯ï¼Ÿ

**åŸå› **ï¼šæœåŠ¡å™¨åº”ç”¨æœªæ­£å¸¸è¿è¡Œ

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
ps aux | grep python

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 8000

# é‡å¯åº”ç”¨
cd /path/to/PAUL
nohup python app.py > app.log 2>&1 &
```

---

## ç›¸å…³æ–‡æ¡£

- ğŸ“„ `docs/æœåŠ¡å™¨é—®é¢˜è¯Šæ–­ä¸ä¿®å¤æŒ‡å—.md` - è¯¦ç»†çš„ä¿®å¤æ­¥éª¤
- ğŸ“„ `docs/cloudflare-ssl-é…ç½®æŒ‡å—.md` - Cloudflare é…ç½®è¯´æ˜
- ğŸ“„ `docs/å°ç¨‹åºæ­£å¼å‘å¸ƒæŒ‡å—.md` - å°ç¨‹åºå‘å¸ƒæµç¨‹
- ğŸ”§ `scripts/quick-fix-nginx.sh` - è‡ªåŠ¨ä¿®å¤è„šæœ¬

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜æ— æ³•è§£å†³ï¼Œè¯·æä¾›ï¼š
1. Nginx é…ç½®æ–‡ä»¶ï¼š`cat /etc/nginx/sites-available/tnho-fasteners.com`
2. Nginx é”™è¯¯æ—¥å¿—ï¼š`sudo tail -n 50 /var/log/nginx/error.log`
3. è¯ä¹¦ä¿¡æ¯ï¼š`sudo certbot certificates`
4. curl æµ‹è¯•ç»“æœï¼š`curl -v https://tnho-fasteners.com/health`
5. å°ç¨‹åºé”™è¯¯æˆªå›¾

---

**æ›´æ–°æ—¶é—´**ï¼š2026-01-13
**æœåŠ¡å™¨**ï¼š47.110.72.148
**åŸŸå**ï¼štnho-fasteners.com
**AppID**ï¼šwx464504ca7e01b3b1

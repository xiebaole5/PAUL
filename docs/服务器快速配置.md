# æœåŠ¡å™¨å¿«é€Ÿé…ç½®æŒ‡å—

## ðŸš€ å¿«é€Ÿé…ç½®ï¼ˆ3æ­¥å®Œæˆï¼‰

### æ­¥éª¤1ï¼šä¸Šä¼ é…ç½®è„šæœ¬

å°† `scripts/nginx-setup.sh` æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ `/app` ç›®å½•ã€‚

æˆ–è€…ç›´æŽ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºï¼š

```bash
cd /app
nano nginx-setup.sh
```

ç„¶åŽå¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š

```bash
#!/bin/bash
echo "å¼€å§‹é…ç½®Nginx..."

# å®‰è£…Nginx
sudo apt update
sudo apt install nginx -y

# åˆ›å»ºç›®å½•
sudo mkdir -p /var/www/certbot
sudo chown -R www-data:www-data /var/www/certbot

# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo tee /etc/nginx/sites-available/tnho-fasteners.com > /dev/null << 'ENDOFFILE'
server {
    listen 80;
    server_name tnho-fasteners.com;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$server_name$request_uri;
    }
}

server {
    listen 443 ssl http2;
    server_name tnho-fasteners.com;

    ssl_certificate /etc/letsencrypt/live/tnho-fasteners.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/tnho-fasteners.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    client_max_body_size 10M;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /assets/ {
        alias /app/assets/;
        expires 7d;
    }
}
ENDOFFILE

# å¯ç”¨é…ç½®
sudo ln -sf /etc/nginx/sites-available/tnho-fasteners.com /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx

echo "âœ… é…ç½®å®Œæˆï¼"
```

ä¿å­˜æ–‡ä»¶ï¼š`Ctrl+O`, `Enter`, `Ctrl+X`

### æ­¥éª¤2ï¼šæ‰§è¡Œè„šæœ¬

```bash
chmod +x nginx-setup.sh
bash nginx-setup.sh
```

### æ­¥éª¤3ï¼šæµ‹è¯•HTTPS

```bash
curl https://tnho-fasteners.com/health
```

åº”è¯¥è¿”å›žï¼š`{"status":"ok"}`

---

## ðŸ“‹ æ‰‹åŠ¨é…ç½®ï¼ˆå¦‚æžœè„šæœ¬å¤±è´¥ï¼‰

### 1. å®‰è£…Nginx

```bash
sudo apt update
sudo apt install nginx -y
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
sudo nano /etc/nginx/sites-available/tnho-fasteners.com
```

å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼ˆæŒ‰Ctrl+Vç²˜è´´ï¼‰ï¼š

```
server {
    listen 80;
    server_name tnho-fasteners.com;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$server_name$request_uri;
    }
}

server {
    listen 443 ssl http2;
    server_name tnho-fasteners.com;

    ssl_certificate /etc/letsencrypt/live/tnho-fasteners.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/tnho-fasteners.com/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    client_max_body_size 10M;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /assets/ {
        alias /app/assets/;
        expires 7d;
    }
}
```

ä¿å­˜ï¼š`Ctrl+O`, `Enter`, `Ctrl+X`

### 3. å¯ç”¨é…ç½®

```bash
sudo ln -s /etc/nginx/sites-available/tnho-fasteners.com /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default
```

### 4. åˆ›å»ºç›®å½•

```bash
sudo mkdir -p /var/www/certbot
sudo chown -R www-data:www-data /var/www/certbot
```

### 5. æµ‹è¯•é…ç½®

```bash
sudo nginx -t
```

### 6. å¯åŠ¨Nginx

```bash
sudo systemctl restart nginx
sudo systemctl enable nginx
```

---

## ðŸ” éªŒè¯é…ç½®

### æ£€æŸ¥NginxçŠ¶æ€

```bash
sudo systemctl status nginx
```

### æµ‹è¯•HTTPSè®¿é—®

```bash
curl https://tnho-fasteners.com/health
```

åº”è¯¥è¿”å›žï¼š`{"status":"ok"}`

### æŸ¥çœ‹æ—¥å¿—

```bash
# è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šnginx -t æµ‹è¯•å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
sudo nginx -t

# æ£€æŸ¥è¯ä¹¦æ˜¯å¦å­˜åœ¨
ls -la /etc/letsencrypt/live/tnho-fasteners.com/

# å¦‚æžœè¯ä¹¦ä¸å­˜åœ¨ï¼Œé‡æ–°ç”³è¯·
sudo certbot certonly --standalone -d tnho-fasteners.com
```

### é—®é¢˜2ï¼šç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥80å’Œ443ç«¯å£
sudo netstat -tlnp | grep -E ":80|:443"

# åœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡
sudo systemctl stop apache2
```

### é—®é¢˜3ï¼šåº”ç”¨æœªè¿è¡Œ

```bash
# æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿è¡Œ
ps aux | grep "python app.py"

# å¦‚æžœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨åº”ç”¨
cd /app
python app.py
```

### é—®é¢˜4ï¼šHTTPSè®¿é—®å¤±è´¥

```bash
# æ£€æŸ¥Nginxé…ç½®
sudo cat /etc/nginx/sites-enabled/tnho-fasteners.com

# æ£€æŸ¥è¯ä¹¦è·¯å¾„
sudo grep ssl_certificate /etc/nginx/sites-enabled/tnho-fasteners.com

# æµ‹è¯•ç›´æŽ¥è®¿é—®æœåŠ¡å™¨ï¼ˆç»•è¿‡Cloudflareï¼‰
curl -kI https://47.110.72.148/health
```

---

## âœ… é…ç½®å®ŒæˆåŽ

1. **é…ç½®Cloudflare**
   - ç™»å½• https://dash.cloudflare.com/
   - SSL/TLSæ¨¡å¼è®¾ä¸º Full

2. **é…ç½®å°ç¨‹åºåŽå°**
   - ç™»å½• https://mp.weixin.qq.com/
   - æ·»åŠ æœåŠ¡å™¨åŸŸåï¼š`https://tnho-fasteners.com`

3. **æµ‹è¯•å°ç¨‹åº**
   - å¯¼å…¥å°ç¨‹åºï¼ˆAppID: wx464504ca7e01b3b1ï¼‰
   - æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

---

## ðŸ“ž èŽ·å–å¸®åŠ©

å¦‚æžœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹Nginxæ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/error.log`
2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`tail -f app.log`
3. æµ‹è¯•APIï¼š`curl https://tnho-fasteners.com/health`

---

**è¯ä¹¦æœ‰æ•ˆæœŸ**ï¼š2026-04-13
**è¯ä¹¦è‡ªåŠ¨ç»­æœŸ**ï¼šå·²é…ç½®
**é…ç½®æ–‡ä»¶ä½ç½®**ï¼š`/etc/nginx/sites-available/tnho-fasteners.com`

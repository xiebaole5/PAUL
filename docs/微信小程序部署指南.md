# å¤©è™¹ç´§å›ºä»¶å¾®ä¿¡å°ç¨‹åº - å®Œæ•´éƒ¨ç½²æŒ‡å—

## é¡¹ç›®ç»“æ„

```
PAUL/
â”œâ”€â”€ src/                          # Python åç«¯ä»£ç 
â”‚   â”œâ”€â”€ main.py                   # FastAPI åç«¯æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ agents/                   # Agent ä»£ç 
â”‚   â”‚   â””â”€â”€ miniprogram_video_agent.py
â”‚   â””â”€â”€ tools/                    # å·¥å…·ä»£ç 
â”‚       â”œâ”€â”€ miniprogram_video_tool.py
â”‚       â””â”€â”€ video_merge_tool.py
â”œâ”€â”€ miniprogram/                  # å¾®ä¿¡å°ç¨‹åºå‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ app.js                    # å°ç¨‹åºå…¨å±€é€»è¾‘
â”‚   â”œâ”€â”€ app.json                  # å°ç¨‹åºå…¨å±€é…ç½®
â”‚   â”œâ”€â”€ sitemap.json              # ç«™ç‚¹åœ°å›¾é…ç½®
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ index/                # è§†é¢‘ç”Ÿæˆé¡µé¢
â”‚           â”œâ”€â”€ index.js          # é¡µé¢é€»è¾‘
â”‚           â”œâ”€â”€ index.wxml        # é¡µé¢ç»“æ„
â”‚           â”œâ”€â”€ index.wxss        # é¡µé¢æ ·å¼
â”‚           â””â”€â”€ index.json        # é¡µé¢é…ç½®
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ miniprogram_video_config.json
â””â”€â”€ requirements.txt              # Python ä¾èµ–
```

## ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½²åç«¯æœåŠ¡

### 1.1 å®‰è£… Python ä¾èµ–

```bash
cd C:\PAUL
pip install -r requirements.txt
```

### 1.2 é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼š

```env
# å¯¹è±¡å­˜å‚¨é…ç½®
COZE_BUCKET_ENDPOINT_URL=https://your-bucket-endpoint
COZE_BUCKET_NAME=your-bucket-name

# ç«å±±æ–¹èˆŸ API é…ç½®
ARK_API_KEY=your-ark-api-key
ARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
ARK_VIDEO_API_KEY=your-video-api-key
```

### 1.3 å¯åŠ¨ FastAPI æœåŠ¡

**Windows CMD:**
```cmd
cd C:\PAUL
python src\main.py
```

**PowerShell:**
```powershell
cd C:\PAUL
python src/main.py
```

æœåŠ¡å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š
```
ğŸš€ å¯åŠ¨ FastAPI æœåŠ¡...
ğŸ“¡ æœåŠ¡åœ°å€: http://0.0.0.0:8000
ğŸ“š API æ–‡æ¡£: http://0.0.0.0:8000/docs
```

### 1.4 éªŒè¯æœåŠ¡

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **API æ–‡æ¡£**: http://localhost:8000/docs

## ç¬¬äºŒæ­¥ï¼šé…ç½®å¾®ä¿¡å°ç¨‹åºå‰ç«¯

### 2.1 ä¿®æ”¹ API åœ°å€

æ‰“å¼€ `miniprogram/app.js`ï¼Œä¿®æ”¹ `apiBaseUrl` ä¸ºä½ çš„æœåŠ¡å™¨åœ°å€ï¼š

```javascript
// æœ¬åœ°æµ‹è¯•
apiBaseUrl: 'http://localhost:8000'

// ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨åï¼‰
apiBaseUrl: 'https://your-domain.com'
```

### 2.2 åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­å¯¼å…¥é¡¹ç›®

1. ä¸‹è½½å¹¶å®‰è£… [å¾®ä¿¡å¼€å‘è€…å·¥å…·](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
3. é€‰æ‹© **"å¯¼å…¥é¡¹ç›®"**
4. é¡¹ç›®ç›®å½•é€‰æ‹©ï¼š`C:\PAUL\miniprogram`
5. AppIDï¼š
   - æµ‹è¯•ï¼šé€‰æ‹©"æµ‹è¯•å·"
   - æ­£å¼ï¼šå¡«å†™ä½ çš„å°ç¨‹åº AppID
6. é¡¹ç›®åç§°ï¼šå¤©è™¹ç´§å›ºä»¶è§†é¢‘ç”Ÿæˆ
7. ç‚¹å‡» **"å¯¼å…¥"**

### 2.3 é…ç½®æœåŠ¡å™¨åŸŸåï¼ˆæ­£å¼ä¸Šçº¿éœ€è¦ï¼‰

åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®æœåŠ¡å™¨åŸŸåï¼š
- ç™»å½• [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
- è¿›å…¥ **å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ æœåŠ¡å™¨åŸŸå**
- åœ¨ **request åˆæ³•åŸŸå** ä¸­æ·»åŠ ä½ çš„æœåŠ¡å™¨åŸŸåï¼ˆéœ€è¦ HTTPSï¼‰
- åœ¨ **uploadFile åˆæ³•åŸŸå** ä¸­æ·»åŠ ä½ çš„æœåŠ¡å™¨åŸŸå

**æ³¨æ„ï¼š** æœ¬åœ°å¼€å‘ä¸éœ€è¦é…ç½®åŸŸåï¼Œç›´æ¥ä½¿ç”¨ `http://localhost:8000`

## ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•å®Œæ•´æµç¨‹

### 3.1 å¯åŠ¨åç«¯æœåŠ¡

```bash
cd C:\PAUL
python src/main.py
```

### 3.2 åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯•

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡» **"ç¼–è¯‘"** è¿è¡Œå°ç¨‹åº
3. æµ‹è¯•æµç¨‹ï¼š
   - è¾“å…¥äº§å“ä¿¡æ¯ï¼ˆäº§å“åç§°ã€ä½¿ç”¨åœºæ™¯ã€ä¸»é¢˜æ–¹å‘ï¼‰
   - ä¸Šä¼ äº§å“å›¾ç‰‡
   - ç‚¹å‡»"ç”Ÿæˆè„šæœ¬"
   - æŸ¥çœ‹ç”Ÿæˆçš„è„šæœ¬ï¼Œç‚¹å‡»"ç¡®è®¤å¹¶ç»§ç»­"
   - é€‰æ‹©é¦–å¸§å›¾ç‰‡å’Œå°¾å¸§å›¾ç‰‡
   - ç‚¹å‡»"ç”Ÿæˆè§†é¢‘"
   - ç­‰å¾…è§†é¢‘ç”Ÿæˆï¼ˆçº¦ 3-5 åˆ†é’Ÿï¼‰
   - æŸ¥çœ‹ç”Ÿæˆçš„è§†é¢‘

## API æ¥å£è¯´æ˜

### 1. ç”Ÿæˆè„šæœ¬

**æ¥å£**: `POST /api/v1/generate-script`

**è¯·æ±‚å‚æ•°**:
```json
{
  "product_name": "é«˜å¼ºåº¦èºæ “",
  "product_image_url": "https://example.com/product.jpg",
  "usage_scenario": "ç”¨äºæ±½è½¦åº•ç›˜è¿æ¥ï¼Œæ‰¿å—é«˜å¼ºåº¦æ‹‰åŠ›",
  "theme_direction": "å“è´¨ä¿è¯"
}
```

**è¿”å›ç»“æœ**:
```json
{
  "code": 0,
  "message": "è„šæœ¬ç”ŸæˆæˆåŠŸ",
  "data": {
    "success": true,
    "script": "ğŸ“ 20ç§’ã€Œé«˜å¼ºåº¦èºæ “ã€å¹¿å‘Šè¥é”€è„šæœ¬...",
    "duration": 20
  }
}
```

### 2. ç”Ÿæˆé¦–å°¾å¸§å›¾ç‰‡

**æ¥å£**: `POST /api/v1/generate-frames`

**è¯·æ±‚å‚æ•°**:
```json
{
  "script": "ç”Ÿæˆçš„è„šæœ¬å†…å®¹",
  "product_name": "é«˜å¼ºåº¦èºæ “",
  "product_image_url": "https://example.com/product.jpg"
}
```

**è¿”å›ç»“æœ**:
```json
{
  "code": 0,
  "message": "å›¾ç‰‡ç”ŸæˆæˆåŠŸ",
  "data": {
    "success": true,
    "first_frames": ["url1", "url2"],
    "last_frames": ["url3", "url4"]
  }
}
```

### 3. ç”Ÿæˆè§†é¢‘

**æ¥å£**: `POST /api/v1/generate-video`

**è¯·æ±‚å‚æ•°**:
```json
{
  "script": "ç”Ÿæˆçš„è„šæœ¬å†…å®¹",
  "product_name": "é«˜å¼ºåº¦èºæ “",
  "product_image_url": "https://example.com/product.jpg",
  "selected_first_frame": "https://example.com/first_frame.jpg",
  "selected_last_frame": "https://example.com/last_frame.jpg"
}
```

**è¿”å›ç»“æœ**:
```json
{
  "code": 0,
  "message": "è§†é¢‘ç”ŸæˆæˆåŠŸ",
  "data": {
    "success": true,
    "video_url": "https://example.com/video.mp4",
    "status": "succeeded",
    "duration": 20
  }
}
```

### 4. ä¸Šä¼ å›¾ç‰‡

**æ¥å£**: `POST /api/v1/upload-image`

**è¯·æ±‚å‚æ•°**: `multipart/form-data`

**è¿”å›ç»“æœ**:
```json
{
  "code": 0,
  "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "image_url": "https://example.com/uploaded.jpg",
    "file_key": "miniprogram_images/uploaded.jpg"
  }
}
```

## å¸¸è§é—®é¢˜

### 1. åç«¯æœåŠ¡å¯åŠ¨å¤±è´¥

**æ£€æŸ¥ Python ç‰ˆæœ¬**: éœ€è¦ Python 3.8+
```bash
python --version
```

**æ£€æŸ¥ä¾èµ–å®‰è£…**:
```bash
pip list | findstr fastapi
```

**æ£€æŸ¥ç«¯å£å ç”¨**:
```bash
netstat -ano | findstr :8000
```

### 2. å¾®ä¿¡å°ç¨‹åºæ— æ³•è¿æ¥åç«¯

**æ£€æŸ¥ API åœ°å€**:
- ç¡®è®¤ `miniprogram/app.js` ä¸­çš„ `apiBaseUrl` é…ç½®æ­£ç¡®
- æœ¬åœ°å¼€å‘ä½¿ç”¨ `http://localhost:8000`
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPS åŸŸå

**æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€**:
- è®¿é—® http://localhost:8000/health ç¡®è®¤æœåŠ¡æ­£å¸¸è¿è¡Œ

### 3. è§†é¢‘ç”Ÿæˆå¤±è´¥

**æ£€æŸ¥ API å¯†é’¥**:
- ç¡®è®¤ `.env` æ–‡ä»¶ä¸­çš„ `ARK_API_KEY` å’Œ `ARK_VIDEO_API_KEY` é…ç½®æ­£ç¡®

**æ£€æŸ¥å¯¹è±¡å­˜å‚¨é…ç½®**:
- ç¡®è®¤ `.env` æ–‡ä»¶ä¸­çš„ `COZE_BUCKET_ENDPOINT_URL` å’Œ `COZE_BUCKET_NAME` é…ç½®æ­£ç¡®

## éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### 1. éƒ¨ç½²åç«¯åˆ°äº‘æœåŠ¡å™¨

æ¨èä½¿ç”¨ä»¥ä¸‹äº‘æœåŠ¡ï¼š
- **é˜¿é‡Œäº‘**: è´­ä¹° ECS æœåŠ¡å™¨ï¼Œå®‰è£… Python ç¯å¢ƒ
- **è…¾è®¯äº‘**: è´­ä¹°äº‘æœåŠ¡å™¨ï¼Œå®‰è£… Python ç¯å¢ƒ
- **åä¸ºäº‘**: è´­ä¹°å¼¹æ€§äº‘æœåŠ¡å™¨ï¼Œå®‰è£… Python ç¯å¢ƒ

éƒ¨ç½²æ­¥éª¤ï¼š
1. è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆå»ºè®® 2 æ ¸ 4GB ä»¥ä¸Šï¼‰
2. å®‰è£… Python 3.8+
3. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
4. å®‰è£…ä¾èµ–: `pip install -r requirements.txt`
5. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåˆ›å»º `.env` æ–‡ä»¶ï¼‰
6. å¯åŠ¨æœåŠ¡: `python src/main.py`
7. é…ç½®åŸŸåå’Œ SSL è¯ä¹¦ï¼ˆæ¨èä½¿ç”¨ Nginx åå‘ä»£ç†ï¼‰
8. é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œå¼€æ”¾ 8000 ç«¯å£

### 2. ä½¿ç”¨è¿›ç¨‹ç®¡ç†å·¥å…·ï¼ˆæ¨èï¼‰

ä½¿ç”¨ `pm2` ç®¡ç† Python è¿›ç¨‹ï¼š
```bash
# å®‰è£… pm2
npm install -g pm2

# å¯åŠ¨æœåŠ¡
pm2 start src/main.py --name miniprogram-api

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs miniprogram-api
```

### 3. ä½¿ç”¨ Nginx åå‘ä»£ç†ï¼ˆæ¨èï¼‰

é…ç½® Nginx:
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚

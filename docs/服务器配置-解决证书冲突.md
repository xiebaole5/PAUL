# æœåŠ¡å™¨é…ç½® - è§£å†³è¯ä¹¦å†²çªé—®é¢˜

## âœ… Nginxå·²æˆåŠŸå¯åŠ¨

æ˜¾ç¤ºï¼š`Active: active (running)` âœ…

## âš ï¸ è­¦å‘Šä¿¡æ¯

```
conflicting server name "tnho-fasteners.com" on 0.0.0.0:80, ignored
conflicting server name "tnho-fasteners.com" on 0.0.0.0:443, ignored
```

è¿™ä¸ªè­¦å‘Šè¡¨ç¤ºæœ‰å¤šä¸ªé…ç½®æ–‡ä»¶å®šä¹‰äº†ç›¸åŒçš„server nameã€‚

## âŒ SSLè¯ä¹¦é”™è¯¯

```
curl: (60) SSL certificate problem: self-signed certificate
```

è¿™æ˜¯å› ä¸ºCloudflareè¿˜åœ¨ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œæˆ–è€…æœ‰å¤šä¸ªé…ç½®å†²çªã€‚

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤1ï¼šæ£€æŸ¥æ‰€æœ‰Nginxé…ç½®æ–‡ä»¶

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é…ç½®
ls -la /etc/nginx/sites-enabled/

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é…ç½®
ls -la /etc/nginx/sites-available/
```

### æ­¥éª¤2ï¼šåˆ é™¤å†²çªçš„é…ç½®

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–é…ç½®æ–‡ä»¶
sudo ls -la /etc/nginx/sites-enabled/

# å¦‚æœæœ‰å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œåˆ é™¤å®ƒä»¬
# ä¾‹å¦‚ï¼š
# sudo rm -f /etc/nginx/sites-enabled/other-config
```

### æ­¥éª¤3ï¼šæ£€æŸ¥å½“å‰é…ç½®å†…å®¹

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
sudo cat /etc/nginx/sites-enabled/tnho-fasteners.com
```

ç¡®è®¤SSLè¯ä¹¦è·¯å¾„æ˜¯ï¼š
```
ssl_certificate /etc/letsencrypt/live/tnho-fasteners.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/tnho-fasteners.com/privkey.pem;
```

### æ­¥éª¤4ï¼šæµ‹è¯•ç›´æ¥è®¿é—®æœåŠ¡å™¨ï¼ˆç»•è¿‡Cloudflareï¼‰

```bash
curl -kI https://47.110.72.148/health
```

ä½¿ç”¨ `-k` å‚æ•°è·³è¿‡è¯ä¹¦éªŒè¯ï¼Œçœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦èƒ½æ­£å¸¸å“åº”ã€‚

å¦‚æœè¿”å› `HTTP/1.1 200 OK`ï¼Œè¯´æ˜æœåŠ¡å™¨é…ç½®æ­£å¸¸ï¼Œé—®é¢˜åœ¨Cloudflareã€‚

### æ­¥éª¤5ï¼šæ£€æŸ¥è¯ä¹¦æ–‡ä»¶

```bash
ls -la /etc/letsencrypt/live/tnho-fasteners.com/
```

åº”è¯¥çœ‹åˆ°ï¼š
```
fullchain.pem
privkey.pem
```

### æ­¥éª¤6ï¼šé‡å¯Nginx

```bash
sudo systemctl restart nginx
```

---

## ğŸŒ é…ç½®Cloudflare

å¦‚æœæœåŠ¡å™¨é…ç½®æ­£å¸¸ï¼ˆé€šè¿‡ `curl -kI https://47.110.72.148/health` æµ‹è¯•æˆåŠŸï¼‰ï¼Œåˆ™éœ€è¦é…ç½®Cloudflareï¼š

### 1. ç™»å½•Cloudflare

è®¿é—®ï¼šhttps://dash.cloudflare.com/

### 2. é…ç½®SSL/TLSæ¨¡å¼

1. é€‰æ‹©åŸŸå `tnho-fasteners.com`
2. è¿›å…¥ **SSL/TLS > Overview**
3. å°†æ¨¡å¼è®¾ç½®ä¸º **Full** æˆ– **Full (strict)**
4. ç­‰å¾…å‡ åˆ†é’Ÿç”Ÿæ•ˆ

### 3. æµ‹è¯•HTTPSè®¿é—®

```bash
# ç­‰å¾…å‡ åˆ†é’Ÿåæµ‹è¯•
curl https://tnho-fasteners.com/health
```

---

## ğŸ” è¯Šæ–­æ­¥éª¤

### è¯Šæ–­1ï¼šæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸

```bash
# ç›´æ¥è®¿é—®æœåŠ¡å™¨ï¼ˆè·³è¿‡Cloudflareï¼‰
curl -kI https://47.110.72.148/health
```

**å¦‚æœæˆåŠŸ**ï¼š
- è¿”å› `HTTP/1.1 200 OK`
- è¯´æ˜æœåŠ¡å™¨é…ç½®æ­£å¸¸
- é—®é¢˜åœ¨Cloudflareï¼Œéœ€è¦é‡æ–°é…ç½®SSL/TLSæ¨¡å¼

**å¦‚æœå¤±è´¥**ï¼š
- æœåŠ¡å™¨é…ç½®æœ‰é—®é¢˜
- ç»§ç»­è¯Šæ–­2

### è¯Šæ–­2ï¼šæ£€æŸ¥Nginxé…ç½®

```bash
# æŸ¥çœ‹å¯ç”¨çš„é…ç½®
ls -la /etc/nginx/sites-enabled/

# åªåº”è¯¥æœ‰ï¼štnho-fasteners.com

# å¦‚æœæœ‰å…¶ä»–æ–‡ä»¶ï¼Œåˆ é™¤å®ƒä»¬
sudo rm -f /etc/nginx/sites-enabled/å…¶ä»–æ–‡ä»¶å
```

### è¯Šæ–­3ï¼šé‡æ–°åŠ è½½Nginx

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status nginx
```

### è¯Šæ–­4ï¼šç›´æ¥æµ‹è¯•åº”ç”¨

```bash
# æµ‹è¯•åº”ç”¨ç«¯å£
curl http://127.0.0.1:8000/health
```

åº”è¯¥è¿”å›ï¼š`{"status":"ok"}`

---

## ğŸ“ å®Œæ•´è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šæœåŠ¡å™¨é…ç½®æ­£ç¡®ï¼Œåªé…ç½®Cloudflare

å¦‚æœ `curl -kI https://47.110.72.148/health` æˆåŠŸï¼š

1. **é…ç½®Cloudflare SSL/TLS**
   - æ¨¡å¼è®¾ä¸º **Full** æˆ– **Full (strict)**
   - ç­‰å¾…5-10åˆ†é’Ÿ

2. **æµ‹è¯•HTTPS**
   ```bash
   curl https://tnho-fasteners.com/health
   ```

3. **å¦‚æœä»ç„¶å¤±è´¥**
   - æ¸…é™¤Cloudflareç¼“å­˜
   - é‡æ–°é…ç½®SSL/TLSæ¨¡å¼
   - ç­‰å¾…æ›´é•¿æ—¶é—´

### æ–¹æ¡ˆBï¼šæœåŠ¡å™¨é…ç½®æœ‰é—®é¢˜ï¼Œé‡æ–°é…ç½®

å¦‚æœ `curl -kI https://47.110.72.148/health` å¤±è´¥ï¼š

1. **åˆ é™¤æ‰€æœ‰é…ç½®**
   ```bash
   sudo rm -f /etc/nginx/sites-enabled/*
   ```

2. **é‡æ–°åˆ›å»ºé…ç½®**
   ```bash
   sudo nano /etc/nginx/sites-available/tnho-fasteners.com
   ```

   ç²˜è´´é…ç½®å†…å®¹ï¼ˆåŒä¸Šï¼‰

3. **å¯ç”¨é…ç½®**
   ```bash
   sudo ln -sf /etc/nginx/sites-available/tnho-fasteners.com /etc/nginx/sites-enabled/
   ```

4. **é‡å¯Nginx**
   ```bash
   sudo systemctl restart nginx
   ```

---

## âš ï¸ å…³äºconflicting server nameè­¦å‘Š

è¿™ä¸ªè­¦å‘Šçš„åŸå› ï¼š
- å¯èƒ½æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶å®šä¹‰äº†ç›¸åŒçš„ `server_name`
- æˆ–è€… `/etc/nginx/nginx.conf` ä¸­æœ‰é‡å¤çš„é…ç½®

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é…ç½®
ls -la /etc/nginx/sites-enabled/

# åªä¿ç•™ tnho-fasteners.comï¼Œåˆ é™¤å…¶ä»–
sudo rm -f /etc/nginx/sites-enabled/default
sudo rm -f /etc/nginx/sites-enabled/å…¶ä»–é…ç½®
```

---

## âœ… éªŒè¯é…ç½®

å®Œæˆé…ç½®åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
# 1. æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# 2. ç›´æ¥è®¿é—®æœåŠ¡å™¨
curl -kI https://47.110.72.148/health

# 3. æµ‹è¯•åº”ç”¨
curl http://127.0.0.1:8000/health

# 4. é€šè¿‡Cloudflareè®¿é—®ï¼ˆç­‰å¾…SSL/TLSæ¨¡å¼ç”Ÿæ•ˆåï¼‰
curl https://tnho-fasteners.com/health
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. **è¿è¡Œè¯Šæ–­1**ï¼šæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸
2. **æ ¹æ®ç»“æœé€‰æ‹©æ–¹æ¡ˆAæˆ–æ–¹æ¡ˆB**
3. **é…ç½®Cloudflare SSL/TLS**
4. **æµ‹è¯•HTTPSè®¿é—®**

---

**å…³é”®æç¤º**ï¼š
- `conflicting server name` è­¦å‘Šå¯ä»¥å¿½ç•¥ï¼Œä¸å½±å“åŠŸèƒ½
- SSLè¯ä¹¦é”™è¯¯é€šå¸¸æ˜¯å› ä¸ºCloudflareé…ç½®é—®é¢˜
- æœåŠ¡å™¨é…ç½®æ­£å¸¸çš„è¯ï¼Œåªéœ€è¦é…ç½®Cloudflareå³å¯

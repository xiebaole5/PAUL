# 新功能说明：图片上传与场景描述

## 🎉 新增功能

智能体现在支持更丰富的视频生成方式：

### 1. 产品图片上传
- 用户可以上传紧固件产品的照片
- AI 将基于图片生成更精准的宣传视频
- 支持 JPG、PNG 格式，最大 5MB

### 2. 使用场景描述
- 用户可以详细描述产品的使用场景
- AI 将根据场景描述生成更贴合需求的视频
- 支持 200 字以内的场景描述

---

## 📱 小程序使用说明

### 新增界面元素

#### 1. 产品图片上传区
- 位于产品名称输入框下方
- 点击上传按钮选择图片
- 上传后可预览图片，也可点击删除图标移除

#### 2. 使用场景描述框
- 位于图片上传区下方
- 支持多行文本输入
- 实时显示字符计数（最多 200 字）

### 使用步骤

1. **输入产品名称**
   ```
   例如：高强度螺栓
   ```

2. **上传产品图片（可选）**
   - 点击"📷 点击上传产品图片"
   - 选择相册或拍照
   - 等待上传完成

3. **描述使用场景（可选）**
   ```
   例如：用于汽车制造中的高强度连接场景，承受高载荷和振动环境
   ```

4. **选择主题**
   - 品质保证
   - 技术创新
   - 工业应用
   - 品牌形象

5. **选择时长**
   - 5/10/15/20/25/30 秒

6. **生成视频**
   - 点击"生成视频"按钮
   - 等待 30-60 秒

---

## 🔧 API 使用说明

### 新增接口

#### 1. 图片上传接口

**接口地址**：`POST /api/upload-image`

**请求方式**：`multipart/form-data`

**请求参数**：
- `file`: 图片文件（必填）

**响应示例**：
```json
{
  "success": true,
  "message": "图片上传成功",
  "image_url": "http://localhost:8000/assets/uploads/xxx.jpg",
  "filename": "xxx.jpg"
}
```

**错误示例**：
```json
{
  "success": false,
  "message": "仅支持 JPG、PNG 格式的图片"
}
```

#### 2. 视频生成接口（更新）

**接口地址**：`POST /api/generate-video`

**新增参数**：
- `scenario`: 使用场景描述（可选，字符串）
- `product_image_url`: 产品图片 URL（可选，字符串）

**完整请求示例**：
```json
{
  "product_name": "高强度螺栓",
  "theme": "品质保证",
  "duration": 20,
  "type": "video",
  "scenario": "用于汽车制造中的高强度连接场景，承受高载荷和振动环境",
  "product_image_url": "http://localhost:8000/assets/uploads/xxx.jpg",
  "session_id": "optional_session_id"
}
```

---

## 💻 工具使用说明

### 更新的工具

#### generate_fastener_promo_video

**新增参数**：
- `scenario`: 使用场景描述（可选，默认为空）
- `product_image_url`: 产品图片 URL（可选，默认为空）

**使用示例**：
```python
# 仅使用场景描述
result = generate_fastener_promo_video(
    product_name="高强度螺栓",
    theme="品质保证",
    duration=20,
    scenario="用于汽车制造中的高强度连接场景"
)

# 同时使用场景描述和图片
result = generate_fastener_promo_video(
    product_name="高强度螺栓",
    theme="工业应用",
    duration=20,
    scenario="用于桥梁建设中的关键连接",
    product_image_url="http://example.com/product.jpg"
)
```

---

## 🎯 使用场景示例

### 示例 1：汽车紧固件宣传

**输入**：
- 产品名称：高强度螺栓
- 产品图片：（上传一张螺栓产品照片）
- 使用场景：用于汽车底盘连接，承受高强度冲击载荷
- 主题：品质保证
- 时长：20秒

**输出**：
- 生成展示螺栓在汽车底盘中的应用视频
- 突出产品的强度和耐久性
- 融入红色 TNHO 商标

### 示例 2：太阳能支架紧固件

**输入**：
- 产品名称：不锈钢螺丝
- 使用场景：用于太阳能光伏支架安装，长期暴露在户外环境
- 主题：工业应用
- 时长：15秒

**输出**：
- 生成展示螺丝在太阳能支架中的应用视频
- 突出产品的耐腐蚀性
- 展现工业应用场景

### 示例 3：通用紧固件

**输入**：
- 产品名称：螺母
- 主题：品牌形象
- 时长：30秒

**输出**：
- 生成企业品牌形象宣传片
- 展现企业实力和品质
- 强化 TNHO 品牌形象

---

## ⚠️ 注意事项

1. **图片上传**
   - 支持 JPG、PNG 格式
   - 最大文件大小 5MB
   - 图片会自动压缩
   - 上传后可随时删除

2. **场景描述**
   - 最多 200 字
   - 建议描述具体的应用场景
   - 可以包含环境、载荷、行业等信息

3. **视频生成**
   - 图片和场景描述都是可选的
   - 如果两者都提供，AI 会综合考虑
   - 视频生成时间约 30-60 秒

4. **图片存储**
   - 图片保存在 `assets/uploads/` 目录
   - 通过静态文件服务访问
   - 生产环境建议使用对象存储

---

## 🚀 开发者指南

### 本地开发

1. **启动后端服务**
   ```bash
   ./scripts/start_backend.sh
   ```

2. **创建上传目录**
   ```bash
   mkdir -p assets/uploads
   ```

3. **测试图片上传**
   - 使用微信开发者工具
   - 上传测试图片
   - 检查 URL 返回是否正确

### 生产环境

1. **配置对象存储**
   - 修改上传接口使用对象存储
   - 配置 CDN 加速
   - 设置访问权限

2. **优化图片处理**
   - 添加图片压缩
   - 限制上传频率
   - 添加病毒扫描

---

## 📝 更新日志

### v1.1.0 (2025-01-12)

- ✅ 新增产品图片上传功能
- ✅ 新增使用场景描述功能
- ✅ 更新视频生成工具，支持图片和场景参数
- ✅ 新增图片上传 API 接口
- ✅ 更新小程序前端，添加图片上传和场景描述界面
- ✅ 完善文档和测试

---

## 📞 技术支持

如有问题，请查看：
- [完整部署指南](DEPLOYMENT_GUIDE.md)
- [小程序使用说明](MINIPROGRAM_README.md)
- [API 文档](src/api/README.md)

---

**体验新功能，让视频生成更精准！🎉**

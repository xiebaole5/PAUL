# 微信小程序测试指南

## 测试时间
2026-01-13

## 测试环境准备

### 开发环境
1. 安装微信开发者工具（最新版）
2. 导入小程序代码（miniprogram目录）
3. 在"详情" → "本地设置"中勾选：
   - ✅ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书

### API地址配置
在 `miniprogram/app.js` 中配置：
```javascript
apiUrl: 'http://47.110.72.148'  // 开发环境
// 或
apiUrl: 'https://tnho-fasteners.com'  // 生产环境（需要配置合法域名）
```

## 功能测试清单

### 1. 图片上传功能测试 ✅

**测试步骤**：
1. 打开小程序首页
2. 点击"产品图片"区域
3. 选择一张图片（JPG或PNG，小于5MB）
4. 观察是否成功上传并显示预览

**预期结果**：
- ✅ 能正常选择图片
- ✅ 上传成功后显示图片预览
- ✅ 提示"上传成功"
- ✅ 图片URL正确传递给API

**验证代码**：
```javascript
// miniprogram/pages/index/index.js
chooseImage() - 选择图片
uploadImage() - 上传图片
```

---

### 2. 视频生成功能测试 ✅

**测试步骤**：
1. 输入产品名称：高强度螺栓
2. 选择主题：品质保证
3. 选择时长：5秒（快速测试）
4. （可选）上传产品图片
5. （可选）输入场景描述
6. 点击"立即生成"按钮

**预期结果**：
- ✅ 请求成功（5秒内返回）
- ✅ 显示"生成中..."提示
- ✅ 开始轮询进度（每2秒一次）
- ✅ 生成完成后跳转到结果页

**验证代码**：
```javascript
// miniprogram/pages/index/index.js
generateVideo() - 生成视频
pollProgress() - 轮询进度
```

---

### 3. 脚本生成功能测试 ⚠️

**测试步骤**：
1. 输入产品名称：不锈钢螺丝
2. 选择主题：技术创新
3. 选择时长：10秒
4. 选择"生成脚本"类型
5. 点击"立即生成"按钮

**预期结果**：
- ✅ 请求成功（120秒内返回）
- ✅ 显示脚本内容
- ✅ 跳转到结果页

**注意事项**：
- ⚠️ 脚本生成可能需要较长时间（30-120秒）
- ⚠️ 如果超时，会显示"生成超时，请稍后重试或减少时长"

**验证代码**：
```javascript
// miniprogram/pages/index/index.js
generateVideo() - 生成脚本（type='script'）
```

---

### 4. 进度查询功能测试 ⚠️

**测试步骤**：
1. 创建一个视频生成任务
2. 观察进度轮询过程
3. 查看进度百分比变化

**预期结果**：
- ✅ 每2秒查询一次进度
- ✅ 显示当前进度和步骤
- ✅ 生成完成后跳转到结果页

**已知问题**：
- ⚠️ 如果数据库连接失败，进度查询会失败
- ⚠️ 影响因素：服务器数据库配置

**验证代码**：
```javascript
// miniprogram/pages/index/index.js
pollProgress() - 轮询进度
```

---

### 5. 图生视频功能测试 ✅

**测试步骤**：
1. 输入产品名称：异形紧固件
2. 选择主题：工业应用
3. 选择时长：5秒
4. 上传一张产品图片（测试图片）
5. 输入场景描述：用于桥梁建设中的关键连接
6. 点击"立即生成"按钮

**预期结果**：
- ✅ 图片URL正确传递给API
- ✅ 视频生成成功
- ✅ 视频内容与产品图片相关

**验证功能**：
- ✅ 图生视频模型：doubao-seedance-1-5-pro-251215
- ✅ API参数：product_image_url

---

### 6. 长视频分段生成测试 ✅

**测试步骤**：
1. 输入产品名称：高强度螺栓
2. 选择主题：品质保证
3. 选择时长：20秒
4. 点击"立即生成"按钮

**预期结果**：
- ✅ 显示提示："20秒视频将自动分段生成并拼接"
- ✅ 生成两段视频（10秒+10秒）
- ✅ 结果页显示拼接后的视频
- ✅ 可以查看和下载各段视频

**验证功能**：
- ✅ 自动分段逻辑：20秒 = 10秒+10秒
- ✅ 视频拼接功能
- ✅ 多段视频展示

---

### 7. 结果页功能测试 ✅

**测试步骤**：
1. 生成视频或脚本
2. 跳转到结果页
3. 测试各功能按钮

**预期结果**：

**视频结果页**：
- ✅ 视频播放器正常播放
- ✅ 显示视频信息（模型、商标等）
- ✅ 多段视频可以切换查看
- ✅ 下载按钮可以下载视频到相册
- ✅ 分享按钮正常

**脚本结果页**：
- ✅ 显示脚本内容
- ✅ 复制按钮可以复制脚本
- ✅ 分享按钮正常

**验证代码**：
```javascript
// miniprogram/pages/result/result.js
downloadVideo() - 下载视频
copyScript() - 复制脚本
```

---

## 错误场景测试

### 1. 网络错误测试

**测试步骤**：
1. 断开网络连接
2. 点击"立即生成"按钮

**预期结果**：
- ✅ 显示错误提示："服务器连接失败，请检查网络或稍后重试"

---

### 2. 超时错误测试

**测试步骤**：
1. 选择"生成脚本"类型
2. 设置较长时长（30秒）
3. 点击"立即生成"按钮
4. 等待超时（超过120秒）

**预期结果**：
- ✅ 显示错误提示："生成超时，请稍后重试或减少时长"

---

### 3. 表单验证测试

**测试步骤**：
1. 不输入产品名称
2. 点击"立即生成"按钮

**预期结果**：
- ✅ 显示提示："请输入产品名称"
- ✅ 不发送API请求

---

## 性能测试

### 1. 响应时间测试

| 功能 | 预期响应时间 | 备注 |
|------|------------|------|
| 图片上传 | < 5秒 | 取决于图片大小和网络 |
| 视频任务创建 | < 5秒 | 异步任务，立即返回task_id |
| 脚本生成 | < 120秒 | 取决于LLM响应 |
| 进度查询 | < 2秒 | 每次轮询 |

### 2. 并发测试

**测试步骤**：
1. 同时创建多个视频生成任务
2. 观察轮询是否正常

**预期结果**：
- ✅ 多个任务可以正常创建
- ✅ 进度查询互不影响

---

## 兼容性测试

### 设备兼容性
- ✅ iOS设备测试通过
- ✅ Android设备测试通过
- ✅ 不同分辨率适配正常

### 微信版本兼容性
- ✅ 微信7.0及以上版本测试通过
- ⚠️ 旧版本可能不支持某些API

---

## 测试结果汇总

| 功能模块 | 测试结果 | 备注 |
|---------|---------|------|
| 图片上传 | ✅ 通过 | 功能正常 |
| 视频生成 | ✅ 通过 | 异步任务正常 |
| 脚本生成 | ⚠️ 部分通过 | 可能超时 |
| 进度查询 | ⚠️ 部分通过 | 受数据库影响 |
| 图生视频 | ✅ 通过 | 功能正常 |
| 长视频分段 | ✅ 通过 | 自动拼接正常 |
| 结果展示 | ✅ 通过 | 功能正常 |
| 错误处理 | ✅ 通过 | 提示友好 |
| 表单验证 | ✅ 通过 | 验证正常 |

**总体通过率**: 7/9 (78%)

---

## 已知问题

### 1. 数据库连接问题
- **影响**: 进度查询功能可能失败
- **状态**: 待修复
- **解决方案**: 修复数据库连接配置

### 2. 脚本生成超时
- **影响**: 可能超过120秒
- **状态**: 已优化（从30秒改为120秒）
- **解决方案**: 优化Agent响应速度

### 3. HTTPS证书问题
- **影响**: 生产环境无法访问
- **状态**: 待修复
- **解决方案**: 使用正式SSL证书

---

## 测试建议

### 开发测试
1. 使用HTTP地址（http://47.110.72.148）
2. 关闭域名校验
3. 测试所有功能

### 生产测试
1. 使用HTTPS地址（https://tnho-fasteners.com）
2. 配置合法域名
3. 申请正式SSL证书
4. 全面功能测试

---

## 测试报告

测试完成后，请填写以下信息：

- **测试人员**: _______________
- **测试日期**: _______________
- **微信版本**: _______________
- **设备型号**: _______________
- **测试结果**: ✅ 通过 / ⚠️ 部分通过 / ❌ 失败
- **发现问题**: _______________
- **建议改进**: _______________

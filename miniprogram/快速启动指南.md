# 天虹紧固件小程序 - 快速启动指南

## 🚀 快速开始

### AppID：wx464504ca7e01b3b1

---

## 第一步：导入小程序项目

1. **打开微信开发者工具**
2. **点击"导入项目"**
3. **选择目录**：`miniprogram`
4. **AppID**：`wx464504ca7e01b3b1`（自动填入）
5. **项目名称**：`天虹紧固件`
6. **点击"导入"**

---

## 第二步：配置开发环境

### 关闭域名校验（开发阶段）

1. **点击右上角"详情"**
2. **选择"本地设置"**
3. **✅ 勾选"不校验合法域名..."**

> 💡 提示：正式上线前需要取消勾选

---

## 第三步：测试小程序

### 3.1 点击"编译"按钮

预览小程序界面。

### 3.2 测试功能

#### 测试1：图片上传
1. 点击"上传产品图片"
2. 选择一张图片（JPG/PNG，<5MB）
3. 等待上传成功
4. 确认图片显示

#### 测试2：视频生成
1. 输入产品名称：例如"六角螺栓"
2. 选择主题：品质保证
3. 选择时长：10秒
4. 点击"立即生成"
5. 查看生成进度
6. 等待视频生成完成（可能需要几分钟）

#### 测试3：脚本生成
1. 点击"生成脚本"（切换类型）
2. 输入产品名称
3. 点击"立即生成"
4. 查看生成的脚本内容

---

## 第四步：检查API配置

### 确认API地址

打开 `miniprogram/app.js`，确认：

```javascript
apiUrl: 'https://tnho-fasteners.com'
```

### 测试API健康检查

在终端运行：

```bash
curl https://tnho-fasteners.com/health
```

**预期结果**：
```json
{
  "status": "ok"
}
```

如果返回错误，检查：
- [ ] 服务器应用是否运行：`ps aux | grep "python app.py"`
- [ ] Nginx是否启动：`sudo systemctl status nginx`
- [ ] SSL证书是否有效：`sudo certbot certificates`

---

## 第五步：发布小程序

### 5.1 准备发布

确保：
- [ ] 所有功能测试通过
- [ ] 无明显Bug和错误
- [ ] 服务器运行正常
- [ ] HTTPS访问正常

### 5.2 上传代码

1. **点击"上传"按钮**
2. **版本号**：`1.0.0`
3. **项目备注**：
   ```
   初始版本
   - 支持AI视频生成
   - 支持脚本生成
   - 支持图生视频
   ```
4. **点击"确定"**

### 5.3 配置小程序后台

#### 登录微信公众平台
访问：https://mp.weixin.qq.com/

#### 配置服务器域名

进入 **开发 > 开发管理 > 服务器域名**，添加：

| 类型 | 域名 |
|------|------|
| request | `https://tnho-fasteners.com` |
| uploadFile | `https://tnho-fasteners.com` |
| downloadFile | `https://tnho-fasteners.com` |

**注意**：
- 必须使用HTTPS
- 等待审核（1-2小时）

#### 完善小程序信息

进入 **设置 > 基本设置**：

- **小程序名称**：天虹紧固件
- **小程序简介**：AI视频生成系统
- **服务类目**：工具 > 其他工具

### 5.4 提交审核

1. 进入 **管理 > 版本管理**
2. 找到版本 **1.0.0**
3. 点击 **提交审核**
4. 填写审核信息：
   - 测试账号：无需填写
   - 功能页面：首页（视频生成）
   - 服务类目：工具 > 其他工具
   - 标签：AI、视频生成、工具
5. 点击 **提交**

### 5.5 发布上线

审核通过后：

1. 进入 **管理 > 版本管理**
2. 找到已审核通过的版本
3. 点击 **发布** 按钮
4. 确认发布信息
5. 点击 **确定**

---

## 常见问题快速修复

### 问题1：图片上传失败

**现象**：显示"网络错误"

**解决**：
```bash
# 测试API
curl https://tnho-fasteners.com/health

# 如果失败，检查服务器
ps aux | grep "python app.py"

# 重启应用
cd /app
python app.py
```

### 问题2：视频生成无响应

**现象**：点击生成后一直转圈

**解决**：
1. 检查API地址是否正确
2. 检查数据库是否运行：`docker ps | grep postgres`
3. 查看服务器日志：`tail -f app.log`

### 问题3：审核被拒绝

**常见原因**：
- 服务器域名未配置
- 证书无效
- 功能描述不符

**解决**：
1. 检查小程序后台域名配置
2. 确认使用Let's Encrypt证书
3. 完善小程序基本信息
4. 重新提交审核

---

## 检查清单

发布前请确认：

### 开发环境 ✅
- [ ] AppID已配置：`wx464504ca7e01b3b1`
- [ ] 项目已导入开发者工具
- [ ] 域名校验已关闭（开发阶段）
- [ ] 所有功能测试通过

### 服务器环境 ✅
- [ ] Let's Encrypt证书已申请
- [ ] Nginx已安装并配置SSL
- [ ] HTTPS访问正常
- [ ] 应用正在运行（8000端口）

### Cloudflare ✅
- [ ] DNS记录已配置
- [ ] SSL/TLS模式为Full
- [ ] Always Use HTTPS已启用

### 小程序后台 ✅
- [ ] 小程序基本信息已完善
- [ ] 服务器域名已配置并审核通过
- [ ] 代码已上传（版本1.0.0）
- [ ] 已提交审核

### 发布上线 ✅
- [ ] 审核已通过
- [ ] 已发布上线

---

## 快速命令

```bash
# 测试API健康检查
curl https://tnho-fasteners.com/health

# 检查应用状态
ps aux | grep "python app.py"

# 检查Nginx状态
sudo systemctl status nginx

# 查看应用日志
tail -f app.log

# 查看Nginx日志
sudo tail -f /var/log/nginx/tnho-fasteners-error.log

# 测试API接口
cd /app/tests
python3 test_server_api.py

# 测试HTTPS配置
python3 test_https_config.py
```

---

## 相关文档

- **完整发布指南**：`docs/发布指南.md`
- **Nginx配置**：`docs/nginx-ssl-config.md`
- **Cloudflare配置**：`docs/cloudflare-config.md`
- **问题修复指南**：`miniprogram/问题修复指南.md`
- **配置说明**：`miniprogram/小程序配置说明.md`

---

## 获取帮助

如果遇到问题：

1. **查看控制台日志**（微信开发者工具 > Console）
2. **查看网络请求**（微信开发者工具 > Network）
3. **查看服务器日志**：`tail -f app.log`
4. **运行测试脚本**：`python3 tests/test_server_api.py`
5. **参考问题修复指南**

---

**AppID**：wx464504ca7e01b3b1
**项目名称**：天虹紧固件
**版本**：1.0.0

祝你发布顺利！🎉
